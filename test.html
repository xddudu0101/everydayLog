<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <form action="" id="fl">
    <input name='username' value="fdasfds" />
  </form>

  <script>
    // 获取表单form元素
    var form = document.getElementById('fl')
    // 编写策略类
    var VerifiPolicy = {
      isNoEmpty: function (value, errorMsg) {
        if (value == '') {
          return errorMsg
        }
      },
      minLength: function (value, length, errorMsg) {
        if (value.length < length) {
          return errorMsg;
        }
      },
      isMobile: function (value, errorMsg) {
        if (!/(^1[3|5|8][0-9]{9}$)/.test(value)) {
          return errorMsg
        }
      }
    }
    // 编写环境类

    // 构造函数
    var Formvalidation = function (VerifiPolicy) {
      // 保存策略对象
      this.strategies = VerifiPolicy;
      // 验证缓存
      this.validationFns = [];
    }
    // add 方法
    Formvalidation.prototype.add = function (dom, rule, errorMsg) {
      var ary = rule.split(':');
      var arg = [];
      var self = this;
      this.validationFns.push(function () {
        arg = []
        var ruleName = ary[0];    // 策略对象方法名
        arg.push(dom.value);
        if (ary[1]) {
          arg.push(ary[1]);
        }
        arg.push(errorMsg);
        // 调用策略函数
        return self.strategies[ruleName].apply(dom, arg);
      })
    }
    // 开始验证
    Formvalidation.prototype.start = function () {
      for (var i = 0; ; i++) {
        console.log(1111, this.validationFns[i])
        var msg = this.validationFns[i] && this.validationFns[i]();
        if (msg) {
          return msg;
        }
      }
    }
    // 创建表单校验实例
    var validation = new Formvalidation(VerifiPolicy)

    // 编写校验配置
    validation.add(form.username, 'isNoEmpty', '用户名不能为空')

    // 开始校验，并接收错误信息
    var errorMsg = validation.start();

    // 如果有错误信息输出，说明校验未通过
    if (errorMsg) {
      // return false;
    }

  </script>
</body>

</html>